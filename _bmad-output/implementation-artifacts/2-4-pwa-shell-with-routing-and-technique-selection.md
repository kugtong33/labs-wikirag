# Story 2.4: PWA Shell with Routing and Technique Selection

Status: review

## Story
As a user, I want to open WikiRAG in my browser as an installable app with technique selection.

## Acceptance Criteria
1. App loads within 3 seconds on localhost with PWA install option
2. Single query view as default with technique selector dropdown
3. Mode toggle switches between single/comparison within 100ms (client-side)
4. Keyboard navigation reaches all interactive elements
5. Semantic HTML for accessibility

## Tasks/Subtasks

- [x] Task 1: Install dependencies and configure Vite + PWA build
  - [x] 1.1: Install React, React DOM, React Router, Zustand, Vite, Tailwind CSS v4
  - [x] 1.2: Create vite.config.ts with vite-plugin-pwa and Tailwind plugin
  - [x] 1.3: Create index.html entry point for Vite
  - [x] 1.4: Create public/wikirag.svg icon and manifest reference
- [x] Task 2: Create Zustand query store (AC3)
  - [x] 2.1: Create stores/query-store.ts with mode, technique, query state
- [x] Task 3: Create TechniqueSelector component (AC2, AC4, AC5)
  - [x] 3.1: Create components/TechniqueSelector.tsx with accessible select dropdown
  - [x] 3.2: Write tests for TechniqueSelector
- [x] Task 4: Create SingleQuery page (AC2, AC4, AC5)
  - [x] 4.1: Create pages/SingleQuery.tsx with mode toggle and technique selector
  - [x] 4.2: Write tests for SingleQuery page
- [x] Task 5: Create App root with React Router (AC1)
  - [x] 5.1: Create src/App.tsx with router and default route to SingleQuery
  - [x] 5.2: Update src/main.tsx to mount React app
  - [x] 5.3: Write tests for App routing
- [x] Task 6: Run build and full test suite
  - [x] 6.1: Confirm vite build succeeds and all tests pass
  - [x] 6.2: Validate all acceptance criteria

## Dev Notes

**Implementation:** React SPA in apps/web with Vite + vite-plugin-pwa. Zustand for state, Tailwind CSS v4 for UI, React Router v7 for routing.

**Key Files:** apps/web/src/App.tsx, pages/SingleQuery.tsx, components/TechniqueSelector.tsx, stores/query-store.ts, vite.config.ts (manifest via vite-plugin-pwa)

**Testing:** Vitest + React Testing Library with jsdom environment, 15 tests across 3 test files.

## Dev Agent Record

### Agent Model Used
claude-sonnet-4-6

### Debug Log References
- `import.meta.env` access: Needed `import.meta.env['VITE_API_BASE_URL']` (bracket notation) for TypeScript strict compliance.
- Test isolation for App: Used `MemoryRouter` from `react-router-dom` to test routing without `BrowserRouter` history side-effects.
- Tailwind v4 integration: No `tailwind.config.ts` needed — `@import "tailwindcss"` in CSS file + `@tailwindcss/vite` plugin handles everything.

### Completion Notes List
- `vite.config.ts`: Vite 6 + `@vitejs/plugin-react` + `@tailwindcss/vite` + `VitePWA` with `generateSW` strategy; manifest includes name, icons, `display: standalone`.
- `index.html`: Standard Vite HTML entry with `#root` mount point and theme-color meta tag.
- `public/wikirag.svg`: Simple SVG icon (blue square with "W") for PWA manifest.
- `src/index.css`: Single `@import "tailwindcss"` — all Tailwind v4 utilities available without config file.
- `src/stores/query-store.ts`: Zustand store with `mode` (single|comparison), `technique` (default: naive-rag), `query` string, and setters. All state transitions synchronous.
- `src/components/TechniqueSelector.tsx`: Native `<select>` with associated `<label>` (htmlFor/id). Keyboard/screen-reader accessible, passes `onChange` callback.
- `src/pages/SingleQuery.tsx`: `<main>` landmark with `<h1>`, `TechniqueSelector`, mode toggle `<button>` (aria-pressed), query `<textarea>` (labelled). Receives techniques as prop.
- `src/App.tsx`: Fetches `/api/techniques` on mount, passes to `SingleQuery`. Routes `/` and `/comparison` both render `SingleQuery` (comparison UI is Story 2.5).
- `src/main.tsx`: Creates React root, wraps app in `<StrictMode>` + `<BrowserRouter>`.
- Vite build: 1.2s, 233KB JS bundle, Tailwind CSS 9KB, service worker generated by Workbox.
- 15 tests: 3 App routing + 5 TechniqueSelector + 7 SingleQuery. All pass.

### File List
- `apps/web/package.json` — MODIFIED: Added react, react-dom, react-router-dom, zustand deps; vite, @vitejs/plugin-react, vite-plugin-pwa, tailwindcss, testing deps; updated build/dev/test scripts
- `apps/web/vite.config.ts` — NEW: Vite config with Tailwind, React, and PWA plugins
- `apps/web/vitest.config.ts` — NEW: Vitest config with jsdom environment and test-setup
- `apps/web/index.html` — NEW: Vite HTML entry point
- `apps/web/public/wikirag.svg` — NEW: PWA icon (SVG)
- `apps/web/src/index.css` — NEW: Tailwind v4 CSS entry
- `apps/web/src/test-setup.ts` — NEW: @testing-library/jest-dom setup
- `apps/web/src/main.tsx` — MODIFIED: React root mount with BrowserRouter
- `apps/web/src/App.tsx` — NEW: App root with React Router and techniques fetch
- `apps/web/src/stores/query-store.ts` — NEW: Zustand query store
- `apps/web/src/components/TechniqueSelector.tsx` — NEW: Accessible technique dropdown
- `apps/web/src/pages/SingleQuery.tsx` — NEW: Default query page with mode toggle
- `apps/web/tests/App.test.tsx` — NEW: 3 routing tests
- `apps/web/tests/TechniqueSelector.test.tsx` — NEW: 5 component tests
- `apps/web/tests/SingleQuery.test.tsx` — NEW: 7 page tests

### Change Log
2026-02-21: Story 2.4 implemented by claude-sonnet-4-6. Vite PWA shell with React Router, Zustand state, Tailwind CSS v4 UI, TechniqueSelector dropdown, mode toggle, semantic HTML. 15 new tests, all passing. Vite build in 1.2s with Workbox service worker.
